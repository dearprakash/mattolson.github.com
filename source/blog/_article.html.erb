<% content_for :onready do %>
  function on_over_sharing() {
    var share_links = $(this).parent().find(".share_links_wrapper");
    var read_later = $(this).parent().find(".read-later_wrapper");
    if ($(this).find(".read-later_wrapper").length > 0) {
      share_links.hide();
      read_later.show();
    }
    
    if ($(this).find(".share_links_wrapper").length > 0) {
      read_later.hide();
      share_links.show();
    }
  }

  function on_out_sharing() {
    $(this).find(".share_links_wrapper").hide();
    $(this).find(".read-later_wrapper").hide();
  }
  
  $("li.share, li.read-later").hoverIntent({
    sensitivity: 1,
    interval: 0,
    over: on_over_sharing,
    timeout: 100,
    out: on_out_sharing
  });

  $("li.share a.button.tiny, li.read-later a.button.tiny").on('click', function(e) {
    on_over_sharing();
    e.preventDefault();
  });
<% end %>

<% article_url = "http://mattolson.com#{article.url}" %>

<div class="row">
  <article class="nine columns">
    <h3>
      <% if digest %>
        <%= link_to article.title, article %>
      <% else %>
        <%= article.title %>
      <% end %>
    </h3>

    <% if digest %>
      <%= article.summary %>
    <% else %>
      <%= article.body %>
    <% end %>

    <% if digest && article.summary.length < article.body.length %>
      <%= link_to 'Read more &rarr;', article, :class => 'secondary button radius' %>
    <% end %>

    <% unless digest %>
      <% if article.tags.include?('synthesis') %>
        <p class="synthesis_comments panel radius">
          This essay was printed in the <%= article.date.strftime('%b %e, %Y') %> issue of The Synthesis Weekly.
          We&rsquo;d like to keep all public comments grouped together, so please 
          <%= link_to 'visit the Synthesis site to comment on this essay', "#{article.data.mainurl}#comments", :target => '_blank' %>.
        </p>
      <% end %>
      <ul class="read_next">
        <li><%= article.previous_article ? link_to("&laquo; #{article.previous_article.title}", article.previous_article) : "&nbsp;" %></li>
        <li><%= article.next_article ? link_to("#{article.next_article.title} &raquo;", article.next_article) : "&nbsp;" %></li>
      </ul>
    <% end %>
  </article>
  <aside class="three columns">
    <ul class="credit">
      <li class="time">Posted on <time datetime="<%= article.date.strftime('%Y-%m-%d') %>"><%= article.date.strftime('%A %b %e, %Y') %></time</li>
    </ul>
    <ul class="tags">
      <% article.tags.each do |tag| %>
        <li><%= link_to tag, tag_path(tag), :class => 'tiny button secondary round' %></li>
      <% end %>
    </ul>
    <% unless digest %>
      <ul class="meta">
        <!--<li class="comments"><a href="http://penman.stylehatch.co/post/14366132330/introducing-penman#disqus_thread" class="dsq-comment-count">&nbsp;</a></li>-->
        <li class="read-later"><a href="#" class="button secondary tiny radius">Read Later</a>
          <div class="read-later_wrapper">
            <div class="share_links">
              <div>
                <p><i>Save to</i></p>
                <ul class="clearfix">
                  <li><a href="http://www.instapaper.com/hello2?url=<%= article_url %>">Instapaper</a></li>
                  <li><a href="https://readitlaterlist.com/save?url=<%= article_url %>&title=<%= article.title %>">Pocket</a></li>
                </ul>
              </div>
            </div>
          </div>
        </li>
        <li class="share"><a href="#" class="button secondary tiny radius">Share</a>
          <div class="share_links_wrapper">
            <div class="share_links">    
              <div class="share-buttons" data-permalink="<%= article_url %>">
                <div class="share-button share-twitter">
                  <a href="https://twitter.com/share" class="twitter-share-button" data-url="<%= article_url %>" data-count="horizontal"></a> 
                </div>
                <div class="share-button share-facebook">
                  <iframe src="http://www.facebook.com/plugins/like.php?href=<%= article_url %>&amp;send=false&amp;layout=button_count&amp;width=90&amp;show_faces=false&amp;action=like&amp;colorscheme=light&amp;font&amp;height=21" scrolling="no" frameborder="0" style="border:none; overflow:hidden; width:90px; height:21px;" allowTransparency="true"></iframe>
                </div>
                <div class="share-button share-gplus">
                  <div class="g-plusone" data-annotation="inline" data-size="medium" data-width="120"></div>
                </div>
              </div>
            </div>
          </div>
        </li>
      </ul>
    <% end %>
  </aside>
</div>
